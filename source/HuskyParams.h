//------------------------------------------------------------------------
// Copyright(c) 2025 shiroyoru.
//
// Licensed under the Apache License, Version 2.0 (the "License");
// you may not use this file except in compliance with the License.
// You may obtain a copy of the License at
//
// http ://www.apache.org/licenses/LICENSE-2.0
//
// Unless required by applicable law or agreed to in writing, software
// distributed under the License is distributed on an "AS IS" BASIS,
// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
// See the License for the specific language governing permissions and
// limitations under the License.
//------------------------------------------------------------------------

#pragma once

namespace shiroyoru {
	inline float wAVG(float x0, float x1, float x) {
		return x1 * x + x0 * (1.f-x);
	}
	namespace Husky {
		constexpr int numHarmonics = 16;
		constexpr float maxTimeSeconds = 10;
		constexpr int maxTimeMiliseconds = 10000;
		constexpr float pi2 = 400.f;  // 400 is for fast_sin 6.283185307179586;
		constexpr float maxFq = 22000.f;
		constexpr float minFq = 1.f;

		constexpr unsigned dftLength = 1024;
		constexpr unsigned halfDftLength = dftLength >> 1;
		constexpr unsigned log2DftLength = 10;
		constexpr float window[halfDftLength] = {
			0.0000000, 0.0000094, 0.0000377, 0.0000849, 0.0001509, 0.0002358, 0.0003395, 0.0004620,
			0.0006034, 0.0007637, 0.0009428, 0.0011407, 0.0013574, 0.0015930, 0.0018473, 0.0021204,
			0.0024123, 0.0027230, 0.0030525, 0.0034007, 0.0037676, 0.0041532, 0.0045576, 0.0049806,
			0.0054223, 0.0058827, 0.0063617, 0.0068593, 0.0073755, 0.0079104, 0.0084637, 0.0090357,
			0.0096261, 0.0102350, 0.0108624, 0.0115083, 0.0121726, 0.0128553, 0.0135564, 0.0142758,
			0.0150135, 0.0157696, 0.0165439, 0.0173364, 0.0181472, 0.0189761, 0.0198232, 0.0206884,
			0.0215716, 0.0224730, 0.0233923, 0.0243296, 0.0252849, 0.0262580, 0.0272490, 0.0282579,
			0.0292846, 0.0303290, 0.0313911, 0.0324709, 0.0335684, 0.0346834, 0.0358160, 0.0369661,
			0.0381337, 0.0393187, 0.0405211, 0.0417408, 0.0429778, 0.0442320, 0.0455035, 0.0467920,
			0.0480977, 0.0494204, 0.0507602, 0.0521168, 0.0534904, 0.0548808, 0.0562880, 0.0577119,
			0.0591525, 0.0606098, 0.0620836, 0.0635739, 0.0650807, 0.0666039, 0.0681435, 0.0696993,
			0.0712714, 0.0728597, 0.0744641, 0.0760845, 0.0777209, 0.0793732, 0.0810414, 0.0827255,
			0.0844252, 0.0861406, 0.0878717, 0.0896183, 0.0913804, 0.0931578, 0.0949507, 0.0967588,
			0.0985821, 0.1004206, 0.1022741, 0.1041427, 0.1060261, 0.1079245, 0.1098376, 0.1117655,
			0.1137079, 0.1156650, 0.1176366, 0.1196226, 0.1216229, 0.1236375, 0.1256663, 0.1277092,
			0.1297662, 0.1318372, 0.1339220, 0.1360206, 0.1381330, 0.1402590, 0.1423986, 0.1445517,
			0.1467182, 0.1488980, 0.1510910, 0.1532972, 0.1555165, 0.1577488, 0.1599940, 0.1622521,
			0.1645228, 0.1668063, 0.1691023, 0.1714107, 0.1737316, 0.1760648, 0.1784102, 0.1807677,
			0.1831373, 0.1855188, 0.1879122, 0.1903174, 0.1927342, 0.1951627, 0.1976026, 0.2000540,
			0.2025166, 0.2049905, 0.2074755, 0.2099715, 0.2124785, 0.2149964, 0.2175249, 0.2200642,
			0.2226140, 0.2251742, 0.2277449, 0.2303258, 0.2329168, 0.2355180, 0.2381291, 0.2407501,
			0.2433809, 0.2460214, 0.2486714, 0.2513309, 0.2539998, 0.2566780, 0.2593654, 0.2620618,
			0.2647673, 0.2674816, 0.2702046, 0.2729363, 0.2756766, 0.2784254, 0.2811825, 0.2839479,
			0.2867214, 0.2895030, 0.2922925, 0.2950898, 0.2978949, 0.3007076, 0.3035278, 0.3063555,
			0.3091904, 0.3120325, 0.3148817, 0.3177379, 0.3206010, 0.3234709, 0.3263474, 0.3292304,
			0.3321199, 0.3350158, 0.3379178, 0.3408260, 0.3437402, 0.3466602, 0.3495861, 0.3525176,
			0.3554547, 0.3583972, 0.3613451, 0.3642982, 0.3672565, 0.3702197, 0.3731879, 0.3761608,
			0.3791384, 0.3821205, 0.3851071, 0.3880981, 0.3910932, 0.3940925, 0.3970957, 0.4001029,
			0.4031138, 0.4061284, 0.4091465, 0.4121680, 0.4151928, 0.4182209, 0.4212520, 0.4242861,
			0.4273231, 0.4303628, 0.4334051, 0.4364499, 0.4394972, 0.4425467, 0.4455984, 0.4486521,
			0.4517078, 0.4547653, 0.4578245, 0.4608853, 0.4639475, 0.4670112, 0.4700760, 0.4731420,
			0.4762090, 0.4792770, 0.4823456, 0.4854150, 0.4884849, 0.4915553, 0.4946259, 0.4976968,
			0.5007677, 0.5038387, 0.5069094, 0.5099800, 0.5130501, 0.5161197, 0.5191888, 0.5222571,
			0.5253246, 0.5283911, 0.5314566, 0.5345208, 0.5375838, 0.5406453, 0.5437053, 0.5467637,
			0.5498203, 0.5528750, 0.5559277, 0.5589784, 0.5620267, 0.5650728, 0.5681164, 0.5711574,
			0.5741958, 0.5772313, 0.5802639, 0.5832935, 0.5863200, 0.5893432, 0.5923630, 0.5953794,
			0.5983921, 0.6014012, 0.6044064, 0.6074077, 0.6104049, 0.6133979, 0.6163867, 0.6193711,
			0.6223510, 0.6253263, 0.6282968, 0.6312625, 0.6342233, 0.6371790, 0.6401295, 0.6430747,
			0.6460145, 0.6489489, 0.6518776, 0.6548005, 0.6577177, 0.6606289, 0.6635340, 0.6664329,
			0.6693256, 0.6722119, 0.6750917, 0.6779649, 0.6808314, 0.6836910, 0.6865438, 0.6893894,
			0.6922280, 0.6950593, 0.6978832, 0.7006997, 0.7035086, 0.7063098, 0.7091032, 0.7118888,
			0.7146664, 0.7174358, 0.7201971, 0.7229500, 0.7256946, 0.7284306, 0.7311580, 0.7338767,
			0.7365866, 0.7392875, 0.7419794, 0.7446622, 0.7473358, 0.7500000, 0.7526548, 0.7553001,
			0.7579357, 0.7605616, 0.7631777, 0.7657838, 0.7683800, 0.7709660, 0.7735417, 0.7761072,
			0.7786622, 0.7812068, 0.7837407, 0.7862639, 0.7887763, 0.7912779, 0.7937684, 0.7962478,
			0.7987161, 0.8011731, 0.8036188, 0.8060530, 0.8084756, 0.8108867, 0.8132859, 0.8156734,
			0.8180490, 0.8204125, 0.8227640, 0.8251033, 0.8274304, 0.8297451, 0.8320473, 0.8343370,
			0.8366141, 0.8388785, 0.8411302, 0.8433689, 0.8455947, 0.8478075, 0.8500072, 0.8521936,
			0.8543668, 0.8565266, 0.8586729, 0.8608057, 0.8629249, 0.8650304, 0.8671222, 0.8692001,
			0.8712640, 0.8733140, 0.8753499, 0.8773716, 0.8793791, 0.8813722, 0.8833510, 0.8853153,
			0.8872651, 0.8892003, 0.8911208, 0.8930265, 0.8949175, 0.8967935, 0.8986545, 0.9005005,
			0.9023315, 0.9041472, 0.9059477, 0.9077328, 0.9095026, 0.9112570, 0.9129958, 0.9147190,
			0.9164266, 0.9181185, 0.9197946, 0.9214549, 0.9230993, 0.9247277, 0.9263401, 0.9279365,
			0.9295166, 0.9310806, 0.9326283, 0.9341597, 0.9356747, 0.9371733, 0.9386554, 0.9401209,
			0.9415699, 0.9430022, 0.9444177, 0.9458165, 0.9471985, 0.9485636, 0.9499118, 0.9512431,
			0.9525573, 0.9538544, 0.9551344, 0.9563972, 0.9576429, 0.9588712, 0.9600823, 0.9612760,
			0.9624523, 0.9636111, 0.9647525, 0.9658763, 0.9669825, 0.9680712, 0.9691422, 0.9701954,
			0.9712310, 0.9722487, 0.9732487, 0.9742308, 0.9751950, 0.9761413, 0.9770696, 0.9779800,
			0.9788723, 0.9797465, 0.9806026, 0.9814406, 0.9822605, 0.9830621, 0.9838456, 0.9846107,
			0.9853576, 0.9860862, 0.9867965, 0.9874883, 0.9881618, 0.9888169, 0.9894536, 0.9900718,
			0.9906714, 0.9912526, 0.9918153, 0.9923594, 0.9928849, 0.9933918, 0.9938801, 0.9943498,
			0.9948009, 0.9952333, 0.9956469, 0.9960419, 0.9964182, 0.9967758, 0.9971146, 0.9974347,
			0.9977360, 0.9980185, 0.9982822, 0.9985272, 0.9987533, 0.9989606, 0.9991491, 0.9993188,
			0.9994696, 0.9996016, 0.9997147, 0.9998090, 0.9998845, 0.9999411, 0.9999788, 0.9999976
		};


		
		constexpr float epsilon = 1E-30f;

		constexpr float norm440hz = 0.01995545f;


		constexpr float maxAcceptableV1 = 0.0625f;
		constexpr float minAcceptableV2 = 0.000001f;
		constexpr float maxShowVolume = 100.f;

		constexpr unsigned vIndex = 0, aIndex = 1, dIndex = 2, sIndex = 3, rIndex = 4;

		constexpr unsigned vControllerIndex = 10;//work around the damn bug of event with tag 0 while a note suddenly stop

		constexpr unsigned fqMainIndex = 5;
		constexpr unsigned keyIndex = 6;
		constexpr unsigned taskIndex = 7;
		constexpr unsigned saveIndex = 8;
		constexpr unsigned bypassIndex = 9;

		constexpr unsigned typeIndexLeftShift = 8;
		constexpr unsigned nthMask = 0xFF;

		constexpr unsigned huskyFileLength = (numHarmonics*5+12+2)*sizeof(float);
	}
}


